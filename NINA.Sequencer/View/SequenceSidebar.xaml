<!--
    Copyright © 2016 - 2024 Stefan Berg <isbeorn86+NINA@googlemail.com> and the N.I.N.A. contributors

    This file is part of N.I.N.A. - Nighttime Imaging 'N' Astronomy.

    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.-->
<UserControl
    x:Class="NINA.View.Sequencer.SequenceSidebar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:altitude="clr-namespace:NINA.WPF.Base.View;assembly=NINA.WPF.Base"
    xmlns:behaviors="clr-namespace:NINA.Sequencer.Behaviors"
    xmlns:cont="clr-namespace:NINA.Sequencer.Container"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:NINA.View.Sequencer"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ninactrl="clr-namespace:NINA.CustomControlLibrary;assembly=NINA.CustomControlLibrary"
    xmlns:ns="clr-namespace:NINA.Core.Locale;assembly=NINA.Core"
    xmlns:sequenceItem="clr-namespace:NINA.Sequencer.SequenceItem"
    xmlns:sequencer="clr-namespace:NINA.Sequencer"
    xmlns:util="clr-namespace:NINA.Core.Utility;assembly=NINA.Core"
    xmlns:wpfutil="clr-namespace:NINA.WPF.Base.Utility;assembly=NINA.WPF.Base"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <wpfutil:SharedResourceDictionary Source="/NINA.WPF.Base;component/Resources/StaticResources/ProfileService.xaml" />
                <wpfutil:SharedResourceDictionary Source="/NINA.WPF.Base;component/Resources/StaticResources/SVGDictionary.xaml" />
                <wpfutil:SharedResourceDictionary Source="/NINA.WPF.Base;component/Resources/StaticResources/Brushes.xaml" />
                <wpfutil:SharedResourceDictionary Source="/NINA.WPF.Base;component/Resources/StaticResources/Converters.xaml" />
                <wpfutil:SharedResourceDictionary Source="/NINA.WPF.Base;component/Resources/Styles/TextBlock.xaml" />
                <wpfutil:SharedResourceDictionary Source="/NINA.WPF.Base;component/Resources/Styles/TextBox.xaml" />
                <wpfutil:SharedResourceDictionary Source="/NINA.WPF.Base;component/Resources/Styles/CheckBox.xaml" />
                <wpfutil:SharedResourceDictionary Source="/NINA.WPF.Base;component/Resources/Styles/ToggleButton.xaml" />
                <wpfutil:SharedResourceDictionary Source="/NINA.Sequencer;component/Resources/Styles/ProgressStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <TabControl TabStripPlacement="Top">
        <TabControl.Resources>
            <Style x:Key="TopTab" TargetType="TabItem">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabItem">
                            <Border
                                Name="PART_Border"
                                Margin="0,3,0,0"
                                Background="Transparent"
                                BorderThickness="0">
                                <Grid Name="PART_Panel">
                                    <ContentPresenter
                                        Name="PART_Content"
                                        Margin="10,5,10,5"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        ContentSource="Header" />
                                </Grid>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="PART_Panel" Property="Background" Value="{StaticResource ButtonBackgroundBrush}" />
                                </Trigger>
                                <Trigger Property="IsSelected" Value="False">
                                    <Setter TargetName="PART_Panel" Property="Background" Value="{StaticResource BackgroundBrush}" />
                                </Trigger>
                                <Trigger SourceName="PART_Panel" Property="IsMouseOver" Value="True">
                                    <Setter TargetName="PART_Panel" Property="Background" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style x:Key="ContainerStyle" TargetType="{x:Type GroupItem}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type GroupItem}">
                            <Border
                                x:Name="ComboExpander"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="0,0,0,1">
                                <Expander IsExpanded="{Binding ElementName=ExpandAll, Path=IsChecked, UpdateSourceTrigger=Explicit}">
                                    <Expander.Header>
                                        <TextBlock
                                            FontStyle="Italic"
                                            FontWeight="Bold"
                                            Foreground="{StaticResource PrimaryBrush}"
                                            Text="{Binding Name}" />
                                    </Expander.Header>
                                    <ItemsPresenter />
                                </Expander>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </TabControl.Resources>
        <TabControl.ItemContainerStyle>
            <Binding Source="{StaticResource TopTab}" />
        </TabControl.ItemContainerStyle>
        <TabItem>
            <TabItem.Header>
                <StackPanel Orientation="Horizontal">
                    <Path
                        Width="20"
                        Height="20"
                        Margin="0,0,10,0"
                        Data="{StaticResource SequenceSVG}"
                        Stretch="Uniform"
                        UseLayoutRounding="True">
                        <Path.Style>
                            <Style TargetType="Path">
                                <Setter Property="Fill" Value="{StaticResource PrimaryBrush}" />
                                <Style.Triggers>

                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabItem}}, Path=IsSelected}" Value="True">
                                        <Setter Property="Fill" Value="{StaticResource ButtonForegroundBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Path.Style>
                    </Path>
                    <TextBlock
                        VerticalAlignment="Center"
                        Style="{StaticResource TabItemTextBox}"
                        Text="{ns:Loc LblInstructions}" />
                </StackPanel>
            </TabItem.Header>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <ninactrl:HintTextBox
                        VerticalAlignment="Center"
                        VerticalContentAlignment="Center"
                        Foreground="{StaticResource PrimaryBrush}"
                        HintText="{ns:Loc LblSearch}"
                        Text="{Binding SequencerFactory.ViewFilter, UpdateSourceTrigger=PropertyChanged}">
                        <ninactrl:HintTextBox.Background>
                            <SolidColorBrush Opacity="0.05" Color="{Binding Color, Source={StaticResource PrimaryBrush}}" />
                        </ninactrl:HintTextBox.Background>
                    </ninactrl:HintTextBox>
                    <ToggleButton
                        Name="ExpandAll"
                        Grid.Column="1"
                        Width="20"
                        Height="20"
                        Margin="2.5"
                        IsChecked="True">
                        <ToggleButton.Style>
                            <Style BasedOn="{StaticResource StaticToggleButton}" TargetType="ToggleButton">
                                <Style.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <Path
                                                    Margin="3.5"
                                                    Data="{StaticResource CollapseAllSVG}"
                                                    Fill="{StaticResource ButtonForegroundDisabledBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="ToolTip">
                                            <Setter.Value>
                                                <ToolTip ToolTipService.ShowOnDisabled="True">
                                                    <TextBlock Text="{ns:Loc LblCollapseAll}" />
                                                </ToolTip>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="False">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <Path
                                                    Margin="3.5"
                                                    Data="{StaticResource ExpandAllSVG}"
                                                    Fill="{StaticResource ButtonForegroundDisabledBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="ToolTip">
                                            <Setter.Value>
                                                <ToolTip ToolTipService.ShowOnDisabled="True">
                                                    <TextBlock Text="{ns:Loc LblExpandAll}" />
                                                </ToolTip>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ToggleButton.Style>
                    </ToggleButton>

                    <ToggleButton
                        Grid.Column="2"
                        Width="20"
                        Height="20"
                        Margin="2.5"
                        IsChecked="{Binding SequencerFactory.SettingsMode}">
                        <ToggleButton.ToolTip>
                            <ToolTip ToolTipService.ShowOnDisabled="True">
                                <TextBlock Text="{ns:Loc Lbl_Sequencer_InstructionsSidebar_SettingsModeTooltip}" />
                            </ToolTip>
                        </ToggleButton.ToolTip>
                        <ToggleButton.Style>
                            <Style BasedOn="{StaticResource TB}" TargetType="ToggleButton">
                                <Style.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <Path
                                                    Margin="2.5"
                                                    Data="{StaticResource SettingsSVG}"
                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="False">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <Path
                                                    Margin="2.5"
                                                    Data="{StaticResource SettingsSVG}"
                                                    Fill="{StaticResource ButtonForegroundDisabledBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ToggleButton.Style>
                    </ToggleButton>
                </Grid>
                <ScrollViewer
                    Grid.Row="1"
                    DataContext="{Binding SequencerFactory}"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto">
                    <ScrollViewer.Resources>
                        <DataTemplate x:Key="StandardTemplate">
                            <Grid>
                                <Border MinHeight="30" DataContext="{Binding Entity}">
                                    <Grid HorizontalAlignment="Stretch">
                                        <Border
                                            MinHeight="30"
                                            HorizontalAlignment="Stretch"
                                            BorderBrush="Transparent">
                                            <Grid
                                                Margin="5,0,0,0"
                                                HorizontalAlignment="Stretch"
                                                Panel.ZIndex="1">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <Path
                                                    Grid.Column="0"
                                                    Width="20"
                                                    Height="20"
                                                    Margin="5,0,0,0"
                                                    Data="{Binding Icon}"
                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                                <TextBlock
                                                    Grid.Column="1"
                                                    Margin="10,0,0,0"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Center"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{Binding Name}" />
                                            </Grid>

                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="White" />
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="False">
                                                            <Setter Property="Background" Value="{StaticResource TertiaryBackgroundBrush}" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Border.ToolTip>
                                                <TextBlock VerticalAlignment="Center" Text="{Binding Description}" />
                                            </Border.ToolTip>
                                        </Border>
                                    </Grid>
                                    <i:Interaction.Behaviors>
                                        <behaviors:DragDropBehavior />
                                    </i:Interaction.Behaviors>
                                </Border>
                                <CheckBox
                                    Height="20"
                                    Margin="0,0,5,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding Enabled, Mode=TwoWay}"
                                    Style="{StaticResource CheckmarkCheckbox}"
                                    Visibility="{Binding Path=DataContext.SequencerFactory.SettingsMode, Converter={StaticResource VisibilityConverter}, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabControl}}}" />
                            </Grid>
                        </DataTemplate>
                        <DataTemplate x:Key="ContainerTemplate">
                            <Grid>
                                <Border MinHeight="30" DataContext="{Binding Entity}">
                                    <Grid HorizontalAlignment="Stretch">
                                        <Border
                                            MinHeight="30"
                                            HorizontalAlignment="Stretch"
                                            BorderBrush="Transparent">
                                            <Grid
                                                Margin="5,0,0,0"
                                                HorizontalAlignment="Stretch"
                                                Panel.ZIndex="1">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <Path
                                                    Grid.Column="0"
                                                    Width="20"
                                                    Height="20"
                                                    Margin="5,0,0,0"
                                                    Data="{StaticResource BoxSVG}"
                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                                <Path
                                                    Grid.Column="1"
                                                    Width="20"
                                                    Height="20"
                                                    Margin="5,0,0,0"
                                                    Data="{Binding Icon}"
                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Margin="10,0,0,0"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Center"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{Binding Name}" />
                                            </Grid>

                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="White" />
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="False">
                                                            <Setter Property="Background" Value="{StaticResource TertiaryBackgroundBrush}" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Border.ToolTip>
                                                <TextBlock VerticalAlignment="Center" Text="{Binding Description}" />
                                            </Border.ToolTip>
                                        </Border>
                                    </Grid>
                                    <i:Interaction.Behaviors>
                                        <behaviors:DragDropBehavior />
                                    </i:Interaction.Behaviors>
                                </Border>
                                <CheckBox
                                    Height="20"
                                    Margin="0,0,5,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding Enabled, Mode=TwoWay}"
                                    Style="{StaticResource CheckmarkCheckbox}"
                                    Visibility="{Binding Path=DataContext.SequencerFactory.SettingsMode, Converter={StaticResource VisibilityConverter}, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabControl}}}" />
                            </Grid>
                        </DataTemplate>
                        <DataTemplate x:Key="TriggerTemplate">
                            <Grid>
                                <Border MinHeight="30" DataContext="{Binding Entity}">
                                    <Grid HorizontalAlignment="Stretch">
                                        <Border
                                            MinHeight="30"
                                            HorizontalAlignment="Stretch"
                                            BorderBrush="Transparent">
                                            <Grid
                                                Margin="5,0,0,0"
                                                HorizontalAlignment="Stretch"
                                                Panel.ZIndex="1">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <Path
                                                    Grid.Column="0"
                                                    Width="20"
                                                    Height="20"
                                                    Margin="5,0,0,0"
                                                    Data="{StaticResource ThunderSVG}"
                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                                <Path
                                                    Grid.Column="1"
                                                    Width="20"
                                                    Height="20"
                                                    Margin="5,0,0,0"
                                                    Data="{Binding Icon}"
                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Margin="10,0,0,0"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Center"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{Binding Name}" />
                                            </Grid>

                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="White" />
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="False">
                                                            <Setter Property="Background" Value="{StaticResource TertiaryBackgroundBrush}" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Border.ToolTip>
                                                <TextBlock VerticalAlignment="Center" Text="{Binding Description}" />
                                            </Border.ToolTip>
                                        </Border>
                                    </Grid>
                                    <i:Interaction.Behaviors>
                                        <behaviors:DragDropBehavior />
                                    </i:Interaction.Behaviors>
                                </Border>
                                <CheckBox
                                    Height="20"
                                    Margin="0,0,5,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding Enabled, Mode=TwoWay}"
                                    Style="{StaticResource CheckmarkCheckbox}"
                                    Visibility="{Binding Path=DataContext.SequencerFactory.SettingsMode, Converter={StaticResource VisibilityConverter}, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabControl}}}" />
                            </Grid>
                        </DataTemplate>
                        <DataTemplate x:Key="ConditionTemplate">
                            <Grid>
                                <Border MinHeight="30" DataContext="{Binding Entity}">
                                    <Grid HorizontalAlignment="Stretch">
                                        <Border
                                            MinHeight="30"
                                            HorizontalAlignment="Stretch"
                                            BorderBrush="Transparent">
                                            <Grid
                                                Margin="5,0,0,0"
                                                HorizontalAlignment="Stretch"
                                                Panel.ZIndex="1">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <Path
                                                    Grid.Column="0"
                                                    Width="20"
                                                    Height="20"
                                                    Margin="5,0,0,0"
                                                    Data="{StaticResource NotepadSVG}"
                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                                <Path
                                                    Grid.Column="1"
                                                    Width="20"
                                                    Height="20"
                                                    Margin="5,0,0,0"
                                                    Data="{Binding Icon}"
                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                    Stretch="Uniform"
                                                    UseLayoutRounding="True" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Margin="10,0,0,0"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Center"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{Binding Name}" />
                                            </Grid>

                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="White" />
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="False">
                                                            <Setter Property="Background" Value="{StaticResource TertiaryBackgroundBrush}" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Border.ToolTip>
                                                <TextBlock VerticalAlignment="Center" Text="{Binding Description}" />
                                            </Border.ToolTip>
                                        </Border>
                                    </Grid>
                                    <i:Interaction.Behaviors>
                                        <behaviors:DragDropBehavior />
                                    </i:Interaction.Behaviors>
                                </Border>
                                <CheckBox
                                    Height="20"
                                    Margin="0,0,5,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding Enabled, Mode=TwoWay}"
                                    Style="{StaticResource CheckmarkCheckbox}"
                                    Visibility="{Binding Path=DataContext.SequencerFactory.SettingsMode, Converter={StaticResource VisibilityConverter}, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabControl}}}" />
                            </Grid>
                        </DataTemplate>
                        <local:SequenceDataTemplateSelector
                            x:Key="ItemSelector"
                            DeepSkyObjectContainer="{StaticResource ContainerTemplate}"
                            SequenceCondition="{StaticResource ConditionTemplate}"
                            SequenceContainer="{StaticResource ContainerTemplate}"
                            SequenceItem="{StaticResource StandardTemplate}"
                            SequenceTrigger="{StaticResource TriggerTemplate}" />
                    </ScrollViewer.Resources>
                    <ItemsControl ItemTemplateSelector="{StaticResource ItemSelector}" ItemsSource="{Binding ItemsView}">

                        <ItemsControl.GroupStyle>
                            <GroupStyle ContainerStyle="{StaticResource ContainerStyle}" />
                        </ItemsControl.GroupStyle>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="{x:Type ContentPresenter}">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Panel.ZIndex" Value="99" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </TabItem>
        <TabItem>
            <TabItem.Style>
                <Style BasedOn="{StaticResource TopTabItem}" TargetType="TabItem">
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Content" Value="{Binding Path=(util:DeferredContent.Content), RelativeSource={RelativeSource Self}}" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="False">
                            <Setter Property="Content" Value="{Binding Content, RelativeSource={RelativeSource Self}}" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </TabItem.Style>
            <TabItem.Header>
                <StackPanel Orientation="Horizontal">
                    <Path
                        Width="20"
                        Height="20"
                        Margin="0,0,10,0"
                        Data="{StaticResource BoxSVG}"
                        Stretch="Uniform"
                        UseLayoutRounding="True">
                        <Path.Style>
                            <Style TargetType="Path">
                                <Setter Property="Fill" Value="{StaticResource PrimaryBrush}" />
                                <Style.Triggers>

                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabItem}}, Path=IsSelected}" Value="True">
                                        <Setter Property="Fill" Value="{StaticResource ButtonForegroundBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Path.Style>
                    </Path>
                    <TextBlock
                        VerticalAlignment="Center"
                        Style="{StaticResource TabItemTextBox}"
                        Text="{ns:Loc LblTemplates}" />
                </StackPanel>
            </TabItem.Header>
            <util:DeferredContent.Content>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid Margin="0,5,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <ninactrl:HintTextBox
                            VerticalAlignment="Center"
                            VerticalContentAlignment="Center"
                            Foreground="{StaticResource PrimaryBrush}"
                            HintText="{ns:Loc LblSearch}"
                            Text="{Binding TemplateController.ViewFilter, UpdateSourceTrigger=PropertyChanged}">
                            <ninactrl:HintTextBox.Background>
                                <SolidColorBrush Opacity="0.05" Color="{Binding Color, Source={StaticResource PrimaryBrush}}" />
                            </ninactrl:HintTextBox.Background>
                        </ninactrl:HintTextBox>
                        <ToggleButton
                            Grid.Column="1"
                            Width="20"
                            Height="20"
                            Margin="2.5"
                            IsChecked="{Binding Source={x:Reference ExpandAll}, Path=IsChecked, Mode=TwoWay}">
                            <ToggleButton.Style>
                                <Style BasedOn="{StaticResource StaticToggleButton}" TargetType="ToggleButton">
                                    <Style.Triggers>
                                        <Trigger Property="IsChecked" Value="True">
                                            <Setter Property="Content">
                                                <Setter.Value>
                                                    <Path
                                                        Margin="3.5"
                                                        Data="{StaticResource CollapseAllSVG}"
                                                        Fill="{StaticResource ButtonForegroundDisabledBrush}"
                                                        Stretch="Uniform"
                                                        UseLayoutRounding="True" />
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="ToolTip">
                                                <Setter.Value>
                                                    <ToolTip ToolTipService.ShowOnDisabled="True">
                                                        <TextBlock Text="{ns:Loc LblCollapseAll}" />
                                                    </ToolTip>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                        <Trigger Property="IsChecked" Value="False">
                                            <Setter Property="Content">
                                                <Setter.Value>
                                                    <Path
                                                        Margin="3.5"
                                                        Data="{StaticResource ExpandAllSVG}"
                                                        Fill="{StaticResource ButtonForegroundDisabledBrush}"
                                                        Stretch="Uniform"
                                                        UseLayoutRounding="True" />
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="ToolTip">
                                                <Setter.Value>
                                                    <ToolTip ToolTipService.ShowOnDisabled="True">
                                                        <TextBlock Text="{ns:Loc LblExpandAll}" />
                                                    </ToolTip>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ToggleButton.Style>
                        </ToggleButton>
                    </Grid>
                    <Border
                        Grid.Row="1"
                        Margin="10,10,10,10"
                        Background="{StaticResource SecondaryBackgroundBrush}"
                        BorderThickness="0"
                        DockPanel.Dock="Top">
                        <TextBlock
                            Padding="10"
                            VerticalAlignment="Center"
                            Foreground="{StaticResource ButtonForegroundBrush}"
                            Text="{ns:Loc LblTemplate_DropTemplateHere}"
                            TextAlignment="Center"
                            TextBlock.FontStyle="Italic"
                            TextWrapping="Wrap" />
                    </Border>

                    <ProgressBar
                        Grid.Row="2"
                        Height="20"
                        Margin="5,5,5,0"
                        VerticalAlignment="Top"
                        Maximum="{Binding TemplateController.TemplatesLoadingTotalCount}"
                        Minimum="0"
                        Visibility="{Binding TemplateController.TemplatesLoading, Converter={StaticResource VisibilityConverter}}"
                        Value="{Binding TemplateController.TemplatesLoadingProgress}" />

                    <ListBox
                        Grid.Row="3"
                        Margin="5,0,0,0"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        Panel.ZIndex="10"
                        Background="{StaticResource BackgroundBrush}"
                        BorderThickness="0"
                        Grid.IsSharedSizeScope="True"
                        ItemContainerStyle="{StaticResource ListBoxItemNoHighlight}"
                        ItemsSource="{Binding TemplateController.TemplatesView}"
                        VirtualizingPanel.IsVirtualizing="True"
                        VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                        Visibility="{Binding TemplateController.TemplatesLoading, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}">

                        <ItemsControl.GroupStyle>
                            <GroupStyle ContainerStyle="{StaticResource ContainerStyle}" />
                        </ItemsControl.GroupStyle>

                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type sequencer:TemplatedSequenceContainer}">
                                <Border MinHeight="30" Margin="0,5,0,0">
                                    <i:Interaction.Behaviors>
                                        <behaviors:DragDropBehavior />
                                    </i:Interaction.Behaviors>
                                    <Border>
                                        <Expander
                                            x:Name="expander"
                                            Margin="5,0,5,0"
                                            HorizontalContentAlignment="Stretch"
                                            Background="Transparent"
                                            Template="{StaticResource DownExpander}">
                                            <Expander.Resources>
                                                <DataTemplate x:Key="SequenceContainerTemplate" DataType="{x:Type cont:SequenceContainer}">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition />
                                                            <RowDefinition />
                                                        </Grid.RowDefinitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="20" />
                                                            <ColumnDefinition />
                                                        </Grid.ColumnDefinitions>
                                                        <Path
                                                            Grid.Row="0"
                                                            Grid.Column="0"
                                                            Width="10"
                                                            Height="10"
                                                            Margin="5,0,5,0"
                                                            Data="{Binding Icon}"
                                                            Fill="{StaticResource ButtonForegroundBrush}"
                                                            Stretch="Uniform"
                                                            UseLayoutRounding="True" />
                                                        <TextBlock
                                                            Grid.Row="0"
                                                            Grid.Column="1"
                                                            Foreground="{StaticResource ButtonForegroundBrush}"
                                                            Text="{Binding Name}" />
                                                        <ItemsControl
                                                            Grid.Row="1"
                                                            Grid.Column="1"
                                                            ItemTemplateSelector="{DynamicResource TemplateSelector}"
                                                            ItemsSource="{Binding Items}" />
                                                    </Grid>
                                                </DataTemplate>
                                                <DataTemplate x:Key="DeepSkyObjectContainerTemplate" DataType="{x:Type cont:DeepSkyObjectContainer}">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition />
                                                            <RowDefinition />
                                                        </Grid.RowDefinitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="20" />
                                                            <ColumnDefinition />
                                                        </Grid.ColumnDefinitions>
                                                        <Path
                                                            Grid.Row="0"
                                                            Grid.Column="0"
                                                            Width="10"
                                                            Height="10"
                                                            Margin="5,0,5,0"
                                                            Data="{Binding Icon}"
                                                            Fill="{StaticResource ButtonForegroundBrush}"
                                                            Stretch="Uniform"
                                                            UseLayoutRounding="True" />
                                                        <TextBlock
                                                            Grid.Row="0"
                                                            Grid.Column="1"
                                                            Foreground="{StaticResource ButtonForegroundBrush}"
                                                            Text="{Binding Name}" />
                                                        <ItemsControl
                                                            Grid.Row="1"
                                                            Grid.Column="1"
                                                            ItemsSource="{Binding Items}" />
                                                    </Grid>
                                                </DataTemplate>
                                                <DataTemplate x:Key="SequenceItemTemplate" DataType="{x:Type sequenceItem:SequenceItem}">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="20" />
                                                            <ColumnDefinition />
                                                        </Grid.ColumnDefinitions>
                                                        <Path
                                                            Grid.Row="0"
                                                            Grid.Column="0"
                                                            Width="10"
                                                            Height="10"
                                                            Margin="5,0,5,0"
                                                            Data="{Binding Icon}"
                                                            Fill="{StaticResource ButtonForegroundBrush}"
                                                            Stretch="Uniform"
                                                            UseLayoutRounding="True" />
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Foreground="{StaticResource ButtonForegroundBrush}"
                                                            Text="{Binding Name}" />
                                                    </Grid>
                                                </DataTemplate>
                                                <local:SequenceDataTemplateSelector
                                                    x:Key="TemplateSelector"
                                                    DeepSkyObjectContainer="{StaticResource DeepSkyObjectContainerTemplate}"
                                                    SequenceContainer="{StaticResource SequenceContainerTemplate}"
                                                    SequenceItem="{StaticResource SequenceItemTemplate}" />
                                            </Expander.Resources>
                                            <Expander.Header>
                                                <DockPanel
                                                    Margin="0,5,0,5"
                                                    HorizontalAlignment="Stretch"
                                                    Background="Transparent">
                                                    <i:Interaction.Behaviors>
                                                        <behaviors:DragDropBehavior />
                                                    </i:Interaction.Behaviors>
                                                    <DockPanel DockPanel.Dock="Left">
                                                        <Path
                                                            x:Name="icon"
                                                            Width="20"
                                                            Height="20"
                                                            Margin="5,0,0,0"
                                                            Data="{StaticResource BoxClosedSVG}"
                                                            Fill="{StaticResource ButtonForegroundBrush}"
                                                            Stretch="Uniform"
                                                            UseLayoutRounding="True" />
                                                        <Path
                                                            Grid.Column="1"
                                                            Width="20"
                                                            Height="20"
                                                            Margin="5,0,0,0"
                                                            Data="{Binding Container.Icon}"
                                                            Fill="{StaticResource ButtonForegroundBrush}"
                                                            Stretch="Uniform"
                                                            UseLayoutRounding="True" />
                                                    </DockPanel>
                                                    <TextBlock
                                                        Margin="5,0,0,0"
                                                        VerticalAlignment="Center"
                                                        FontWeight="Bold"
                                                        Foreground="{StaticResource ButtonForegroundBrush}"
                                                        Text="{Binding Container.Name}" />
                                                </DockPanel>
                                            </Expander.Header>
                                            <Expander.Content>
                                                <ItemsControl
                                                    Margin="0,5,0,5"
                                                    ItemTemplateSelector="{StaticResource TemplateSelector}"
                                                    ItemsSource="{Binding Container.Items}" />
                                            </Expander.Content>
                                        </Expander>

                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="White" />
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="False">
                                                        <Setter Property="Background" Value="{StaticResource TertiaryBackgroundBrush}" />
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Border.ToolTip>
                                            <TextBlock VerticalAlignment="Center" Text="{Binding Description}" />
                                        </Border.ToolTip>
                                    </Border>
                                </Border>
                                <DataTemplate.Triggers>
                                    <Trigger SourceName="expander" Property="IsExpanded" Value="true">
                                        <Setter TargetName="icon" Property="Data" Value="{StaticResource BoxSVG}" />
                                    </Trigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <i:Interaction.Behaviors>
                        <behaviors:DragOverBehavior DragOverCenterText="{ns:Loc LblDragOver_AddTemplate}" DragOverDisplayAnchor="Left" />
                        <behaviors:DropIntoBehavior AllowedDragDropTypesString="NINA.Sequencer.Container.SequenceContainer" OnDropCommand="AddTemplateCommand" />
                    </i:Interaction.Behaviors>
                </Grid>
            </util:DeferredContent.Content>
        </TabItem>
        <TabItem>
            <TabItem.Style>
                <Style BasedOn="{StaticResource TopTabItem}" TargetType="TabItem">
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Content" Value="{Binding Path=(util:DeferredContent.Content), RelativeSource={RelativeSource Self}}" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="False">
                            <Setter Property="Content" Value="{Binding Content, RelativeSource={RelativeSource Self}}" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </TabItem.Style>
            <TabItem.Header>
                <StackPanel Orientation="Horizontal">
                    <Path
                        Width="20"
                        Height="20"
                        Margin="0,0,10,0"
                        Data="{StaticResource PictureSVG}"
                        Stretch="Uniform"
                        UseLayoutRounding="True">
                        <Path.Style>
                            <Style TargetType="Path">
                                <Setter Property="Fill" Value="{StaticResource PrimaryBrush}" />
                                <Style.Triggers>

                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabItem}}, Path=IsSelected}" Value="True">
                                        <Setter Property="Fill" Value="{StaticResource ButtonForegroundBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Path.Style>
                    </Path>
                    <TextBlock
                        VerticalAlignment="Center"
                        Style="{StaticResource TabItemTextBox}"
                        Text="{ns:Loc LblTargets}" />
                </StackPanel>
            </TabItem.Header>
            <util:DeferredContent.Content>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Grid Margin="0,5,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <ninactrl:HintTextBox
                            VerticalAlignment="Center"
                            VerticalContentAlignment="Center"
                            Foreground="{StaticResource PrimaryBrush}"
                            HintText="{ns:Loc LblSearch}"
                            Text="{Binding TargetController.ViewFilter, UpdateSourceTrigger=PropertyChanged}">
                            <ninactrl:HintTextBox.Background>
                                <SolidColorBrush Opacity="0.05" Color="{Binding Color, Source={StaticResource PrimaryBrush}}" />
                            </ninactrl:HintTextBox.Background>
                        </ninactrl:HintTextBox>
                        <ToggleButton
                            Grid.Column="1"
                            Width="20"
                            Height="20"
                            Margin="2.5"
                            IsChecked="{Binding Source={x:Reference ExpandAll}, Path=IsChecked, Mode=TwoWay}">
                            <ToggleButton.Style>
                                <Style BasedOn="{StaticResource StaticToggleButton}" TargetType="ToggleButton">
                                    <Style.Triggers>
                                        <Trigger Property="IsChecked" Value="True">
                                            <Setter Property="Content">
                                                <Setter.Value>
                                                    <Path
                                                        Margin="3.5"
                                                        Data="{StaticResource CollapseAllSVG}"
                                                        Fill="{StaticResource ButtonForegroundDisabledBrush}"
                                                        Stretch="Uniform"
                                                        UseLayoutRounding="True" />
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="ToolTip">
                                                <Setter.Value>
                                                    <ToolTip ToolTipService.ShowOnDisabled="True">
                                                        <TextBlock Text="{ns:Loc LblCollapseAll}" />
                                                    </ToolTip>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                        <Trigger Property="IsChecked" Value="False">
                                            <Setter Property="Content">
                                                <Setter.Value>
                                                    <Path
                                                        Margin="3.5"
                                                        Data="{StaticResource ExpandAllSVG}"
                                                        Fill="{StaticResource ButtonForegroundDisabledBrush}"
                                                        Stretch="Uniform"
                                                        UseLayoutRounding="True" />
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="ToolTip">
                                                <Setter.Value>
                                                    <ToolTip ToolTipService.ShowOnDisabled="True">
                                                        <TextBlock Text="{ns:Loc LblExpandAll}" />
                                                    </ToolTip>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ToggleButton.Style>
                        </ToggleButton>
                    </Grid>
                    <Grid Grid.Row="1" Margin="0,5,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <ToggleButton
                            Margin="0,0,1,0"
                            Command="{Binding TargetController.ToggleSortCommand}"
                            IsChecked="{Binding TargetController.SortByName}"
                            Style="{StaticResource TB}">
                            <TextBlock Text="{ns:Loc LblByName}" />
                        </ToggleButton>
                        <ToggleButton
                            Grid.Column="1"
                            Margin="1,0,0,0"
                            Command="{Binding TargetController.ToggleSortCommand}"
                            IsChecked="{Binding TargetController.SortByRelevance}"
                            Style="{StaticResource TB}">
                            <TextBlock Text="{ns:Loc LblByRelevance}" />
                        </ToggleButton>
                    </Grid>
                    <Border
                        Grid.Row="2"
                        Margin="10,10,10,10"
                        Background="{StaticResource SecondaryBackgroundBrush}"
                        BorderThickness="0"
                        DockPanel.Dock="Top">
                        <TextBlock
                            Padding="10"
                            VerticalAlignment="Center"
                            Foreground="{StaticResource ButtonForegroundBrush}"
                            Text="{ns:Loc Lbl_Sequencer_TargetSidebar_DropTargetHere}"
                            TextAlignment="Center"
                            TextBlock.FontStyle="Italic"
                            TextWrapping="Wrap" />
                    </Border>

                    <ProgressBar
                        Grid.Row="3"
                        Height="20"
                        Margin="5,5,5,0"
                        VerticalAlignment="Top"
                        Maximum="{Binding TargetController.TargetsLoadingTotalCount}"
                        Minimum="0"
                        Visibility="{Binding TargetController.TargetsLoading, Converter={StaticResource VisibilityConverter}}"
                        Value="{Binding TargetController.TargetsLoadingProgress}" />


                    <ListBox
                        Grid.Row="3"
                        Margin="5,0,0,0"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        Panel.ZIndex="10"
                        Background="{StaticResource BackgroundBrush}"
                        BorderThickness="0"
                        Grid.IsSharedSizeScope="True"
                        ItemContainerStyle="{StaticResource ListBoxItemNoHighlight}"
                        ItemsSource="{Binding TargetController.TargetsView}"
                        VirtualizingPanel.IsVirtualizing="True"
                        VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                        Visibility="{Binding TargetController.TargetsLoading, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}">
                        <ItemsControl.GroupStyle>
                            <GroupStyle ContainerStyle="{StaticResource ContainerStyle}" />
                        </ItemsControl.GroupStyle>

                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="0,5,0,0">
                                    <i:Interaction.Behaviors>
                                        <behaviors:DragDropBehavior />
                                    </i:Interaction.Behaviors>
                                    <Grid x:Name="PART_Grid">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="InfoColumn" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel
                                            Grid.ColumnSpan="2"
                                            Margin="5"
                                            DataContext="{Binding Container}"
                                            Orientation="Vertical">
                                            <TextBlock
                                                FontWeight="Bold"
                                                Foreground="{StaticResource ButtonForegroundBrush}"
                                                Text="{Binding Name}" />
                                        </StackPanel>
                                        <StackPanel
                                            Grid.Row="1"
                                            Margin="10,0,0,0"
                                            DataContext="{Binding Container}"
                                            Orientation="Vertical">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock
                                                    MinWidth="50"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{ns:Loc LblRA}" />
                                                <TextBlock
                                                    Margin="5,0,0,0"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{Binding Target.InputCoordinates.RAHours}" />
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text=":" />
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text="{Binding Target.InputCoordinates.RAMinutes}" />
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text=":" />
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text="{Binding Target.InputCoordinates.RASeconds, StringFormat={}{0:N1}}" />
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock
                                                    MinWidth="50"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{ns:Loc LblDec}" />


                                                <TextBlock Margin="5,0,0,0" Foreground="{StaticResource ButtonForegroundBrush}">
                                                    <TextBlock.Text>
                                                        <MultiBinding Converter="{StaticResource DecDegreeConverter}" UpdateSourceTrigger="LostFocus">
                                                            <Binding Path="Target.InputCoordinates.NegativeDec" />
                                                            <Binding Path="Target.InputCoordinates.DecDegrees" />
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text=":" />
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text="{Binding Target.InputCoordinates.DecMinutes}" />
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text=":" />
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text="{Binding Target.InputCoordinates.DecSeconds, StringFormat={}{0:N1}}" />
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock
                                                    MinWidth="50"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{ns:Loc LblRotation}" />
                                                <TextBlock
                                                    Margin="5,0,0,0"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{Binding Target.PositionAngle, StringFormat={}{0:N2}}" />
                                                <TextBlock Foreground="{StaticResource ButtonForegroundBrush}" Text="°" />
                                            </StackPanel>
                                            <StackPanel DataContext="{Binding Target.DeepSkyObject}" Orientation="Horizontal">
                                                <ToggleButton
                                                    Width="50"
                                                    Height="24"
                                                    Margin="0,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Center"
                                                    IsChecked="{Binding Moon.DisplayMoon}">
                                                    <ToggleButton.ToolTip>
                                                        <ToolTip ToolTipService.ShowOnDisabled="True">
                                                            <TextBlock Text="{ns:Loc LblDisplayMoonChart}" />
                                                        </ToolTip>
                                                    </ToggleButton.ToolTip>
                                                    <ToggleButton.Style>
                                                        <Style BasedOn="{StaticResource TB}" TargetType="ToggleButton">
                                                            <Style.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter Property="Content">
                                                                        <Setter.Value>
                                                                            <Grid>
                                                                                <Path
                                                                                    Margin="5"
                                                                                    Data="{StaticResource NewMoonSVG}"
                                                                                    Fill="{StaticResource ButtonForegroundBrush}"
                                                                                    Stretch="Uniform"
                                                                                    UseLayoutRounding="True" />
                                                                                <Path
                                                                                    Margin="5"
                                                                                    Data="{Binding Moon.Phase, Converter={StaticResource MoonPhaseToGeometryConverter}}"
                                                                                    Fill="Black"
                                                                                    Stretch="Uniform"
                                                                                    UseLayoutRounding="True" />
                                                                            </Grid>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </Trigger>
                                                                <Trigger Property="IsChecked" Value="False">
                                                                    <Setter Property="Content">
                                                                        <Setter.Value>
                                                                            <Grid>
                                                                                <Path
                                                                                    Margin="5"
                                                                                    Data="{StaticResource NewMoonSVG}"
                                                                                    Fill="{StaticResource ButtonForegroundDisabledBrush}"
                                                                                    Stretch="Uniform"
                                                                                    UseLayoutRounding="True" />
                                                                                <Path
                                                                                    Margin="5"
                                                                                    Data="{Binding Moon.Phase, Converter={StaticResource MoonPhaseToGeometryConverter}}"
                                                                                    Fill="Black"
                                                                                    Stretch="Uniform"
                                                                                    UseLayoutRounding="True" />
                                                                            </Grid>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ToggleButton.Style>
                                                </ToggleButton>
                                                <TextBlock
                                                    Margin="5,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Foreground="{StaticResource ButtonForegroundBrush}"
                                                    Text="{Binding Moon.SeparationText}"
                                                    ToolTip="{ns:Loc LblMoonSeparation}" />
                                            </StackPanel>
                                        </StackPanel>

                                        <altitude:AltitudeChart
                                            Grid.Row="1"
                                            Grid.Column="1"
                                            MinWidth="100"
                                            Margin="10,0,5,5"
                                            HorizontalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch"
                                            AnnotateAltitudeAxis="False"
                                            AnnotateTimeAxis="False"
                                            DataContext="{Binding Container.Target.DeepSkyObject}"
                                            NighttimeData="{Binding DataContext.Container.NighttimeData, ElementName=PART_Grid}"
                                            ShowMoon="False" />
                                    </Grid>
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{StaticResource SecondaryBackgroundBrush}" />
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource ButtonBackgroundSelectedBrush}" />
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="False">
                                                    <Setter Property="Background" Value="{StaticResource TertiaryBackgroundBrush}" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <i:Interaction.Behaviors>
                        <behaviors:DragOverBehavior DragOverCenterText="{ns:Loc Lbl_Sequencer_TargetSidebar_DragOver_AddTarget}" DragOverDisplayAnchor="Left" />
                        <behaviors:DropIntoBehavior AllowedDragDropTypesString="NINA.Sequencer.Container.DeepSkyObjectContainer" OnDropCommand="AddTargetToControllerCommand" />
                    </i:Interaction.Behaviors>
                </Grid>
            </util:DeferredContent.Content>
        </TabItem>
    </TabControl>
</UserControl>